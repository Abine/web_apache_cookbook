#
# Cookbook Name:: web_apache
#
# Copyright RightScale, Inc. All rights reserved.
# All access and use subject to the RightScale Terms of Service available at
# http://www.rightscale.com/terms.php and, if applicable, other agreements
# such as a RightScale Master Subscription Agreement.
#
# Managed by RightScale
# DO NOT EDIT BY HAND
#

<VirtualHost *:<%= @params[:vhost_port] %>>
  ServerName <%= @params[:server_name] %>
  # Setup ServerAlias'
  <% if (node[:web_apache][:server_aliases] == 'Production') -%>
    ServerAlias tracker.abine.com support.abine.com license.abine.com mm.abine.com email.abine.com mapping.abine.com payments.abine.com fraud.abine.com phone.abine.com
  <% elsif (node[:web_apache][:server_aliases] == 'Stage') -%>
      ServerAlias staging-tracker.abine.com staging-support.abine.com staging-license.abine.com staging-mm.abine.com staging-email.abine.com staging-mapping.abine.com staging-payments.abine.com staging-fraud.abine.com staging-phone.abine.com
  <% elsif (node[:web_apache][:server_aliases] == 'Test') -%>
      ServerAlias test-license.abine.com test-mm.abine.com test-email.abine.com test-mapping.abine.com test-payments.abine.com test-fraud.abine.com test-phone.abine.com
  <% elsif (node[:web_apache][:server_aliases] == 'Demo') -%>
      ServerAlias demo-license.abine.com demo-mm.abine.com demo-email.abine.com demo-mapping.abine.com demo-payments.abine.com demo-fraud.abine.com demo-phone.abine.com
  <% end -%>

  DocumentRoot <%= @params[:docroot] %>
  <DirectoryMatch  /\.git/|/\.svn/ >
    Deny from all
  </DirectoryMatch>

  <Directory <%= @params[:docroot] %>>
    Options FollowSymLinks
    AllowOverride <%= @params[:allow_override] %>
    Order allow,deny
    Allow from all
  </Directory>

  RewriteEngine On
  # Uncomment for rewrite debugging
  #RewriteLog <%= node[:apache][:log_dir] %>/http_rewrite.log
  #RewriteLogLevel 9

  # Include Rewrite rules from server config for maintenance mode.
  # Rewrite rules are not inherited in VirtualHost Directive, so must
  # explicitly include it here.
  Include conf.d/maintenance.conf

  # Enable status page for monitoring purposes
  RewriteCond %{REMOTE_ADDR} ^(127.0.0.1)
  RewriteRule ^(/server-status) $1 [H=server-status,L]

  # Setup the logs in the appropriate directory
  <% if node[:web_apache][:system_log] == 'true' -%>
  CustomLog "|/usr/bin/logger -t apache -i -p local2.notice" <%= node[:web_apache][:log_format] %>
  ErrorLog syslog:local1
  <% else -%>
  CustomLog <%= node[:apache][:log_dir] %>/access.log <%= node[:web_apache][:log_format] %>
  ErrorLog  <%= node[:apache][:log_dir] %>/error.log
  <% end -%>

  # Serve any existing local files directly (except actionable ones)
  RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} -f
  RewriteCond %{REQUEST_FILENAME} !\.php|\.jsp|\.do|\.action$ [NC]
  RewriteRule ^/(.*)$ /$1 [QSA,L]

<% if (node[:web_apache][:lb_type] == 'abine.com') -%>

##=====================================================================
#1. Add rewrite rules to write OLD webpages to NEW webpages.
##=====================================================================

RewriteCond %{REQUEST_URI} !^/maskme/v2/tag.php [NC]
#RewriteCond %{REQUEST_URI} !^/support/email [NC]
RewriteCond %{REQUEST_URI} !^/support/email(/?) [NC]
#RewriteCond %{REQUEST_URI} !^/support/email/index.php [NC]
#RewriteCond %{REQUEST_URI} !^/support/email/submit.php [NC]
RewriteCond %{REQUEST_URI} !^/about.html [NC]
RewriteCond %{REQUEST_URI} !^/index.html [NC]
RewriteCond %{REQUEST_URI} !^/maskme.html [NC]
RewriteCond %{REQUEST_URI} !^/about/press-releases(/?) [NC]
RewriteCond %{REQUEST_URI} !^/mail/index.php [NC]
RewriteRule ^/ab_click.php /index.html [R=301,L,NC]
RewriteRule ^/about($|/$) /about.html [R=301,L,NC]
RewriteRule ^/admin.php /index.html [R=301,L,NC]
RewriteRule ^/administrator(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/applyfix.php /index.html [R=301,L,NC]
RewriteRule ^/apps.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/avira(/?) /donottrackme.html [R=301,L,NC]
RewriteRule ^/confirmerror.php /support.html [R=301,L,NC]
RewriteRule ^/confirmsuccess.php /support.html [R=301,L,NC]
RewriteRule ^/contact.php /support.html [R=301,L,NC]
RewriteRule ^/cookies(/?) /donottrackme.html [R=301,L,NC]
RewriteRule ^/dnt($|/) /donottrackme.html [R=301,L,NC]
RewriteRule ^/dntdetail.php /index.html [R=301,L,NC]
RewriteRule ^/dntoffer.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/dntp(/?)$ /donottrackme.html [R=301,L,NC]
RewriteRule ^/donottrackme(/?)$ /donottrackme.html [R=301,L,NC]
RewriteRule ^/download.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/downloads.php /index.html [R=301,L,NC]
RewriteRule ^/edit_cookies.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/facebook.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/facebookfaq.php /support.html [R=301,L,NC]
RewriteRule ^/faqs2.php /support.html [R=301,L,NC]
RewriteRule ^/forums(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/full(/?) /index.html [R=301,L,NC]
RewriteRule ^/getdonottrackme /donottrackme.html [R=301,L,NC]
RewriteRule ^/gettingstarted.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/giveaway.php /index.html [R=301,L,NC]
RewriteRule ^/googlesharing(/?) /donottrackme.html [R=301,L,NC]
RewriteRule ^/goprivate(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/howitworks.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/howtocheck.php /support.html [R=301,L,NC]
RewriteRule ^/howtoprotect.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/html/home(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/index-home2.php /index.html [R=301,L,NC]
RewriteRule ^/index.php /index.html [R=301,L,NC]
RewriteRule ^/infographic(/?)$ /donottrackme.html [R=301,L,NC]
RewriteRule ^/jobs($|/|/jobs.php) /about.html [R=301,L,NC]
RewriteRule ^/join_form.php /index.html [R=301,L,NC]
RewriteRule ^/join.php /index.html [R=301,L,NC]
RewriteRule ^/labels.rdf /index.html [R=301,L,NC]
#RewriteRule ^/mai(/?) /index.html [R=301,L,NC]
RewriteRule ^/mailing(/?) /index.html [R=301,L,NC]
RewriteRule ^/manual.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/marketing/plans(/?)$ /donottrackme.html [R=301,L,NC]
#RewriteRule ^/maskme(/?)$ /maskme.html [R=301,L,NC]
RewriteRule ^/masterpass.php /index.html [R=301,L,NC]
RewriteRule ^/masterpassDG.php /index.html [R=301,L,NC]
RewriteRule ^/member(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/mm(/?) /maskme.html [R=301,L,NC]
RewriteRule ^/modules.php /index.html [R=301,L,NC]
RewriteRule ^/more/logins.php /index.html [R=301,L,NC]
RewriteRule ^/more/toolbar.php /support.html [R=301,L,NC]
RewriteRule ^/more(/?) /donottrackme.html [R=301,L,NC]
RewriteRule ^/optout(/?)$ /donottrackme.html [R=301,L,NC]
RewriteRule ^/posting.php /index.html [R=301,L,NC]
RewriteRule ^/preview/taco.php /index.html [R=301,L,NC]
RewriteRule ^/preview/tour.php /index.html [R=301,L,NC]
RewriteRule ^/preview(/?) /donottrackme.html [R=301,L,NC]
RewriteRule ^/pricing.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/privacy-email-updates(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/privacysuite(/?)$ /donottrackme.html [R=301,L,NC]
RewriteRule ^/privacysuite/cookies.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/privacysuite/faq/agreement/php(/?)$ /support.html [R=301,L,NC]
RewriteRule ^/privacysuitebeta(/?)$ /donottrackme.html [R=301,L,NC]
RewriteRule ^/privacywatchdetail.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/products.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/products(/?)$ /donottrackme.html [R=301,L,NC]
RewriteRule ^/profile.php /index.html [R=301,L,NC]
RewriteRule ^/protectedsearch(/?)$ /donottrackme.html [R=301,L,NC]
RewriteRule ^/proxy.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/publicfaq.php /support.html [R=301,L,NC]
RewriteRule ^/publicfeatures.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/register.php /index.html [R=301,L,NC]
RewriteRule ^/releasenotes(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/reportbugthanks.php /index.html [R=301,L,NC]
RewriteRule ^/requestfix.php /support.html [R=301,L,NC]
RewriteRule ^/rules.abe /index.html [R=301,L,NC]
RewriteRule ^/safebrowsing(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/scripts(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/setoptout.php /support.html [R=301,L,NC]
RewriteRule ^/speedtests.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/subscribe.php /index.html [R=301,L,NC]
RewriteRule ^/support/cookies.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/support/customerfeedback.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/support/knownissues.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/support(/?)$ /support.html [R=301,L,NC]
RewriteRule ^/team($|.php) /about.html [R=301,L,NC]
RewriteRule ^/taco_source.php /support.html [R=301,L,NC]
RewriteRule ^/TACO(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/TACO/TACO.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/The-Ultimate-Guide-to-Twitter-Privacy(/?) /index.html [R=301,L,NC]
RewriteRule ^/Tips-to-Lock-Down-Your-Privacy-On-Facebook(/?) /index.html [R=301,L,NC]
RewriteRule ^/trackers /donottrackme.html [R=301,L,NC]
RewriteRule ^/videos.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/viewform.php /index.html [R=301,L,NC]
RewriteRule ^/vs/alertwindow.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/vs/formwindow.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/vs/loginwindow.php /index.html [R=301,L,NC]
RewriteRule ^/vs/removetoolbar.php /support.html [R=301,L,NC]
RewriteRule ^/vs(/?)$ /index.html [R=301,L,NC]
RewriteRule ^/yourrights.php /donottrackme.html [R=301,L,NC]
# Added 6/25
#RewriteRule ^/deleteme/faq(/?) /support.html [R=301,L,NC]
RewriteRule ^/dntlicense.php /legal.html [R=301,L,NC]
RewriteRule ^/dntuninstall.php /support.html [R=301,L,NC]
RewriteRule ^/how-donottrackme-works(/?) /donottrackme.html [R=301,L,NC]
RewriteRule ^/legal/terms/cards(/?) /legal.html [R=301,L,NC]
#RewriteRule ^/optouts.php /blog/2012/how-to-delete-things-from-the-internet/ [R=301,L,NC]
RewriteRule ^/terms-of-service/ /legal.html [R=301,L,NC]
RewriteRule ^/tracking.php /https://dnt.abine.com/#understandingTracking [R=301,L,NC]
RewriteRule ^/agreement.php /legal.html [R=301,L,NC]
RewriteRule ^/careers(/?) /about.html [R=301,L,NC]
RewriteRule ^/confirmsuccess.php /donottrackme.html [R=301,L,NC]
#RewriteRule ^/deleteme/faq.php /support.html [R=301,L,NC]
#RewriteRule ^/deleteme/faq(/?) /support.html [R=301,L,NC]
RewriteRule ^/deleteme/mobiquo/mobiquo.php /support.html [R=301,L,NC]
RewriteRule ^/deleteme/nextsteps/deletesearches /support.html [R=301,L,NC]
#RewriteRule ^/deleteme/peoplesearchlist /support.html [R=301,L,NC]
RewriteRule ^/deleteme/termsofservice /legal.html [R=301,L,NC]
#RewriteRule ^/dmfaqs.php /support.html [R=301,L,NC]
RewriteRule ^/dntlicense.php /legal.html [R=301,L,NC]
RewriteRule ^/dntp/faq.php /support.html [R=301,L,NC]
RewriteRule ^/feedback.php /support.html [R=301,L,NC]
RewriteRule ^/infographics/what_is_online_tracking_infographic.php /https://dnt.abine.com/#understandingTracking [R=301,L,NC]
RewriteRule ^/jobs.php /about.html [R=301,L,NC]
RewriteRule ^/legal/terms/cards(/?) /legal.html [R=301,L,NC]
RewriteRule ^/marketing/howitworks(/?) /support.html [R=301,L,NC]
RewriteRule ^/post-install/update-success.php /donottrackme.html [R=301,L,NC]
RewriteRule ^/products/deleteme/mobile/support/privacypolicy.php /legal.html [R=301,L,NC]
#=====================================================================
#2. Add rewrite rules to write OLD to NEW in the load balancer config.
# * It seems to be better to use a 302 instead of just rewriting
#=====================================================================
#Only enter this filter if you're going to blog posts
RewriteCond %{REQUEST_URI} ^/blog [NC]
#And now all the rules, in alpha reverse-chrono order
RewriteRule /blog/2014/1-trillion-trackers-blocked-dntme-community /blog/2014/donottrackme-blocks-1-trillion-trackers  [R=301,L,NC]
RewriteRule /blog/2014/adblock-plus-doesnt-protect-online-privacy /blog/2014/adblock-plus-and-online-privacy  [R=301,L,NC]
RewriteRule /blog/2014/free-masked-credit-cards-for-target-and-neiman-marcus /blog/2014/free-masked-cards-for-data-breach-victims  [R=301,L,NC]
RewriteRule /blog/2014/yahoo-email-accounts-hacked-third-party-database /blog/2014/yahoo-email-hack  [R=301,L,NC]
RewriteRule /blog/2013/3-little-things-for-big-online-privacy-improvement /blog/2013/online-privacy-improvements  [R=301,L,NC]
RewriteRule /blog/2013/5-simple-online-privacy-tips /blog/2013/online-privacy-tips  [R=301,L,NC]
RewriteRule /blog/2013/5-things-love-mozillas-add-ons-store-firefox /blog/2013/why-we-love-mozilla-firefox-addon-store  [R=301,L,NC]
RewriteRule /blog/2013/5-tips-to-make-your-online-love-life-less-public /blog/2013/valentines-day-privacy-tips  [R=301,L,NC]
RewriteRule /blog/2013/5-tips-to-protect-yourself-after-the-livingsocial-password-breach /blog/2013/livingsocial-data-breach  [R=301,L,NC]
RewriteRule /blog/2013/5-tips-to-save-money-using-online-privacy-tools /blog/2013/save-money-using-online-privacy-tools  [R=301,L,NC]
RewriteRule /blog/2013/5-tips-to-stop-facebook-from-tracking-your-real-life-shopping /blog/2013/stop-facebook-stalking  [R=301,L,NC]
RewriteRule /blog/2013/5-ways-to-stop-spam-email-today /blog/2013/stop-spam-email-today  [R=301,L,NC]
RewriteRule /blog/2013/6-new-trackers-added-to-dntmes-block-list /blog/2013/donottrackme-more-trackers  [R=301,L,NC]
RewriteRule /blog/2013/8-essential-facebook-photo-privacy-tips /blog/2013/facebook-photo-privacy-tips  [R=301,L,NC]
RewriteRule /blog/2013/9-easy-ways-to-beat-identity-thieves /blog/2013/beat-identity-thieves  [R=301,L,NC]
RewriteRule /blog/2013/a-collection-of-nsa-memes /blog/2013/nsa-memes  [R=301,L,NC]
RewriteRule /blog/2013/actual-facebook-graph-searches-tumblr-shows-how-searches-could-ruin-lives /blog/2013/life-ruining-facebook-searches  [R=301,L,NC]
RewriteRule /blog/2013/acxioms-letting-see-data /blog/2013/acxioms-letting-you-see-data  [R=301,L,NC]
RewriteRule /blog/2013/adobe-2-9-million-hacked-users-protected /blog/2013/adobe-hack-and-data-breach  [R=301,L,NC]
RewriteRule /blog/2013/attack-of-the-drones-privacy-at-ces-2013-day-2 /blog/2013/privacy-at-ces-day-2  [R=301,L,NC]
RewriteRule /blog/2013/autofill-forms-put-6-hours-back-on-the-clock-annually /blog/2013/autofill-forms-save-you-time  [R=301,L,NC]
RewriteRule /blog/2013/big-flickr-photo-sharing-oops /blog/2013/flickr-privacy-breach  [R=301,L,NC]
RewriteRule /blog/2013/can-you-trust-the-little-people-running-big-surveillance /blog/2013/little-people-big-surveillance  [R=301,L,NC]
RewriteRule /blog/2013/demi-moore-ashton-kutcher-both-know-the-value-of-privacy /blog/2013/the-value-of-privacy  [R=301,L,NC]
RewriteRule /blog/2013/email-metadata-tells-a-story /blog/2013/email-metadata-story  [R=301,L,NC]
RewriteRule /blog/2013/eric-schmidt-does-a-double-take-on-privacy /blog/2013/eric-schmidt-on-privacy  [R=301,L,NC]
RewriteRule /blog/2013/eu-regulators-unhappy-with-googles-lack-of-action-regarding-new-privacy-policy /blog/2013/eu-regulators-and-google-privacy-policy  [R=301,L,NC]
RewriteRule /blog/2013/facebook-likes-strongly-indicate-sexual-orientation-religion-more /blog/2013/facebook-likes-predict-who-you-are  [R=301,L,NC]
RewriteRule /blog/2013/facebooks-gunning-for-linkedin-and-google-with-new-graph-search /blog/2013/facebook-graph-search  [R=301,L,NC]
RewriteRule /blog/2013/fighting-cispa-one-domain-name-transfer-at-a-time /blog/2013/domain-name-transfers-and-privacy  [R=301,L,NC]
RewriteRule /blog/2013/give-your-twitter-account-a-good-spring-cleaning /blog/2013/twitter-account-spring-cleaning  [R=301,L,NC]
RewriteRule /blog/2013/google_play_app_leak /blog/2013/google-play-app-leak  [R=301,L,NC]
RewriteRule /blog/2013/google-says-gmail-users-have-no-expectation-of-privacy /blog/2013/google-on-gmail-privacy  [R=301,L,NC]
RewriteRule /blog/2013/happy-national-doughnut-day-we-ate-one-of-those-glazed-donut-sandwiches-to-celebrate /blog/2013/happy-national-doughnut-day  [R=301,L,NC]
RewriteRule /blog/2013/happy-wednesday-heres-a-dog-in-a-jacket /blog/2013/dog-in-a-jacket  [R=301,L,NC]
RewriteRule /blog/2013/have-you-seen-your-digital-footprint-lately /blog/2013/your-digital-footprint  [R=301,L,NC]
RewriteRule /blog/2013/how-firefoxs-new-cookie-settings-compare-to-dntme /blog/2013/firefox-new-privacy-settings  [R=301,L,NC]
RewriteRule /blog/2013/how-to-choose-a-vpn-that-actually-protects-your-privacy /blog/2013/vpn-that-protects-your-privacy  [R=301,L,NC]
RewriteRule /blog/2013/how-to-get-hired-at-a-tech-startup-without-any-engineering-skills /blog/2013/get-hired-at-a-tech-startup  [R=301,L,NC]
RewriteRule /blog/2013/how-to-turn-on-twitters-2-factor-authentication /blog/2013/twitter-2-factor-authentication  [R=301,L,NC]
RewriteRule /blog/2013/introducing-donottrackme-3-0-stop-online-tracking-even-shop /blog/2013/introducing-all-new-donottrackme  [R=301,L,NC]
RewriteRule /blog/2013/introducing-maskme-why-ever-give-away-your-real-personal-info-online /blog/2013/introducing-maskme  [R=301,L,NC]
RewriteRule /blog/2013/is-facebook-the-third-wheel-in-your-relationship-our-survey-results-say-yes /blog/2013/facebook-privacy-and-your-relationship  [R=301,L,NC]
RewriteRule /blog/2013/is-your-online-presence-killing-your-job-prospects /blog/2013/online-presence-and-your-job-prospects  [R=301,L,NC]
RewriteRule /blog/2013/jay-zs-got-99-problems-and-his-app-privacy-is-1 /blog/2013/jay-z-app-privacy  [R=301,L,NC]
RewriteRule /blog/2013/okcupid-moderators-read-private-messages-between-users /blog/2013/okcupid-and-private-messages  [R=301,L,NC]
RewriteRule /blog/2013/online-tracking-kill-credit-score /blog/2013/your-credit-score-and-online-tracking  [R=301,L,NC]
RewriteRule /blog/2013/privacy-boost-dntme-now-blocks-9-more-trackers /blog/2013/donottrackme-adds-more-trackers  [R=301,L,NC]
RewriteRule /blog/2013/privacy-xkcd /blog/2013/privacy-personality-types  [R=301,L,NC]
RewriteRule /blog/2013/real-life-minority-report-more-privacy-at-ces-2013-day-1 /blog/2013/privacy-at-ces-day-1  [R=301,L,NC]
RewriteRule /blog/2013/review-donottrackme-and-enter-to-win-250-to-amazon-com /blog/2013/review-donottrackme-for-amazon-gift-card  [R=301,L,NC]
RewriteRule /blog/2013/say-hello-to-the-new-abine-website /blog/2013/new-abine-website-2013  [R=301,L,NC]
RewriteRule /blog/2013/scared-of-an-online-password-hack-heres-how-to-prevent-it /blog/2013/prevent-online-password-hack  [R=301,L,NC]
RewriteRule /blog/2013/target-data-breach-and-what-you-can-do-about-it /blog/2013/target-data-breach-solution  [R=301,L,NC]
RewriteRule /blog/2013/target-data-breach-privacy-and-control /blog/2013/target-data-breach  [R=301,L,NC]
RewriteRule /blog/2013/the-facebook-phone-isnt-a-phone-its-a-super-app /blog/2013/facebook-super-app  [R=301,L,NC]
RewriteRule /blog/2013/the-future-of-passwords-how-sharing-with-your-friends-could-beef-up-your-security-and-reduce-websites-data-breach-risk /blog/2013/the-future-of-strong-passwords  [R=301,L,NC]
RewriteRule /blog/2013/the-government-is-spying-us-verizon-users /blog/2013/government-spying-on-verizon-users  [R=301,L,NC]
RewriteRule /blog/2013/the-identity-theft-movie-sequence /blog/2013/identity-theft-movie  [R=301,L,NC]
RewriteRule /blog/2013/the-tumblr-hack-and-the-future-of-online-security /blog/2013/tumblr-hack-and-future-of-online-security  [R=301,L,NC]
RewriteRule /blog/2013/twitter-launches-redone-transparency-site-to-show-you-how-often-law-enforcement-asks-for-user-data /blog/2013/twitter-privacy-and-transparency  [R=301,L,NC]
RewriteRule /blog/2013/vanishing-rights-stop-online-privacy-disappearing /blog/2013/vanishing-rights-stop-online-privacy-from-disappearing  [R=301,L,NC]
RewriteRule /blog/2013/what-happens-at-mardi-gras-parties-ends-up-on-facebook /blog/2013/mardi-gras-and-facebook-privacy  [R=301,L,NC]
RewriteRule /blog/2013/what-manti-te-os-fake-girlfriend-should-teach-us-about-privacy /blog/2013/manti-teo-online-privacy-lessons  [R=301,L,NC]
RewriteRule /blog/2013/why-the-loss-of-online-privacy-will-kill-free-speech /blog/2013/online-privacy-and-free-speech  [R=301,L,NC]
RewriteRule /blog/2013/will-google-glass-be-the-next-big-privacy-violation /blog/2013/google-glass-will-violate-privacy  [R=301,L,NC]
RewriteRule /blog/2013/xbox-one-will-know-your-face-voice-and-heartbeat /blog/2013/xbox-one-and-facial-recognition  [R=301,L,NC]
RewriteRule /blog/2013/yahoo-now-scans-through-your-emails-and-chats-after-tos-update /blog/2013/yahoo-email-privacy-after-new-tos-update  [R=301,L,NC]
RewriteRule /blog/2013/you-cant-stop-the-nsa-from-tracking-you-but-you-can-mess-up-their-data /blog/2013/stop-the-nsa-from-tracking-you  [R=301,L,NC]
RewriteRule /blog/2013/your-dntme-just-got-a-privacy-boost /blog/2013/donottrackme-privacy-boost  [R=301,L,NC]
RewriteRule /blog/2012/11-tips-for-more-online-privacy /blog/2012/more-online-privacy  [R=301,L,NC]
RewriteRule /blog/2012/4-tips-to-protect-yourself-from-the-linkedin-password-breach /blog/2012/linkedin-data-breach-of-passwords  [R=301,L,NC]
RewriteRule /blog/2012/5-tips-for-staying-private-on-cyber-monday /blog/2012/stay-private-on-cyber-monday  [R=301,L,NC]
RewriteRule /blog/2012/5-ways-to-disappear-from-the-web-like-katie-holmes-tom-cruise /blog/2012/disappear-from-the-web  [R=301,L,NC]
RewriteRule /blog/2012/7-simple-ways-to-stay-private-and-save-money-while-doing-your-holiday-shopping /blog/2012/stay-private-for-holiday-shopping  [R=301,L,NC]
RewriteRule /blog/2012/abine-on-cnn-why-big-companies-buy-and-sell-your-data /blog/2012/why-big-companies-sell-your-data  [R=301,L,NC]
RewriteRule /blog/2012/after-the-ipo-facebooks-definitely-focused-on-advertising-heres-a-little-easter-egg-to-prove-it /blog/2012/facebook-ipo-and-privacy  [R=301,L,NC]
RewriteRule /blog/2012/an-open-question-to-the-presidential-campaigns-about-their-databases-full-of-voter-information /blog/2012/data-questions-for-presidential-campaigns  [R=301,L,NC]
RewriteRule /blog/2012/be-part-of-the-worlds-easiest-flash-mob-on-may-15th /blog/2012/join-the-privacy-flash-mob  [R=301,L,NC]
RewriteRule /blog/2012/beyond-privacy-puppies-pancakes-behind-the-scenes-at-abine-with-james /blog/2012/behind-the-scenes-at-abine-with-james  [R=301,L,NC]
RewriteRule /blog/2012/beyond-privacy-puppies-pancakes-behind-the-scenes-at-abine-with-ted /blog/2012/behind-the-scenes-at-abine-with-ted  [R=301,L,NC]
RewriteRule /blog/2012/brace-yourself-facebook-spam-is-coming /blog/2012/facebook-spam-is-coming  [R=301,L,NC]
RewriteRule /blog/2012/clean-up-your-online-presence-for-job-search /blog/2012/clean-up-your-online-presence  [R=301,L,NC]
RewriteRule /blog/2012/commerce-departments-first-ever-privacy-meeting-underwhelms /blog/2012/commerce-department-privacy-meeting  [R=301,L,NC]
RewriteRule /blog/2012/do-not-track-data-brokers-what-wed-like-to-see-in-privacy-our-public-comment-to-congress /blog/2012/how-data-brokers-should-change  [R=301,L,NC]
RewriteRule /blog/2012/do-your-privacy-a-favor-control-the-7-most-critical-facebook-settings-post-timeline /blog/2012/most-important-facebook-privacy-settings  [R=301,L,NC]
RewriteRule /blog/2012/facebook-gets-20-million-slap-on-the-wrist-for-using-you-in-advertising /blog/2012/facebook-privacy-violated-by-new-ads  [R=301,L,NC]
RewriteRule /blog/2012/facebook-privacy-vote-now-or-forever-hold-your-peace /blog/2012/facebook-privacy-vote  [R=301,L,NC]
RewriteRule /blog/2012/facebooks-going-public-but-you-dont-have-to-goprivate-with-abine /blog/2012/facebook-going-public-go-private-with-abine  [R=301,L,NC]
RewriteRule /blog/2012/facebooks-got-a-plan-to-ramp-up-advertising-heres-what-you-need-to-know /blog/2012/facebook-advertising-and-privacy  [R=301,L,NC]
RewriteRule /blog/2012/ftc-gives-more-muscle-to-childrens-online-privacy-protection-act-coppa /blog/2012/ftc-improves-cyber-safety-for-kids  [R=301,L,NC]
RewriteRule /blog/2012/good-to-know-but-not-good-enough /blog/2012/google-privacy-campaign  [R=301,L,NC]
RewriteRule /blog/2012/google-handed-over-11385-peoples-personal-info-to-the-government-in-the-past-6-months /blog/2012/google-gives-user-information-to-the-government  [R=301,L,NC]
RewriteRule /blog/2012/hacker-group-releases-1-million-unique-apple-device-ids-what-does-this-mean-for-your-privacy /blog/2012/hackers-release-apple-customers-private-information  [R=301,L,NC]
RewriteRule /blog/2012/how-facebook-buttons-can-track-you-across-the-web /blog/2012/how-facebook-buttons-track-you  [R=301,L,NC]
RewriteRule /blog/2012/how-to-bury-negative-search-results-4-steps-to-do-it-yourself /blog/2012/push-negative-search-results-down  [R=301,L,NC]
RewriteRule /blog/2012/andrew-jira /blog/2012/how-to-delete-things-from-the-internet  [R=301,L,NC]
RewriteRule /blog/2012/how-to-delete-things-from-the-internet-a-guide-to-doing-the-impossible /blog/2012/how-to-delete-things-from-the-internet  [R=301,L,NC]
RewriteRule /blog/2012/how-to-delete-yourself-from-beenverified-com /blog/2012/remove-yourself-from-beenverified  [R=301,L,NC]
RewriteRule /blog/2012/how-to-delete-yourself-from-spokeo-com /blog/2012/how-to-delete-yourself-from-spokeo  [R=301,L,NC]
RewriteRule /blog/2012/how-to-protect-yourself-from-any-data-breach /blog/2012/protect-yourself-from-any-data-breach  [R=301,L,NC]
RewriteRule /blog/2012/how-to-stop-verizon-from-selling-your-information-to-marketers /blog/2012/stop-verizon-from-selling-your-information  [R=301,L,NC]
RewriteRule /blog/2012/instagrams-new-policies-let-it-use-your-photos /blog/2012/instagrams-new-privacy-policies  [R=301,L,NC]
RewriteRule /blog/2012/introducing-dnt-keep-your-personal-information-personal-in-2012 /blog/2012/introducing-donottrackplus-2012  [R=301,L,NC]
RewriteRule /blog/2012/introducing-donottrackme-dntme-for-online-privacy-made-easy /blog/2012/donottrackplus-now-donottrackme  [R=301,L,NC]
RewriteRule /blog/2012/online-tracking-is-worse-than-ever-says-berkeley-census /blog/2012/online-tracking-worse-than-ever  [R=301,L,NC]
RewriteRule /blog/2012/our-second-web-privacy-census-with-uc-berkeley-shows-online-tracking-is-at-an-all-time-high-infographic /blog/2012/abine-privacy-study-with-uc-berkeley  [R=301,L,NC]
RewriteRule /blog/2012/people-can-look-you-up-on-facebook-using-your-phone-number-heres-how-to-stop-them /blog/2012/facebook-profiles-by-phone-number  [R=301,L,NC]
RewriteRule /blog/2012/petition-for-childrens-online-privacy-protections /blog/2012/childrens-online-privacy  [R=301,L,NC]
RewriteRule /blog/2012/petraeuss-emails-werent-private-and-neither-are-yours /blog/2012/email-more-private-than-petraeus  [R=301,L,NC]
RewriteRule /blog/2012/poll-95-of-consumers-want-to-remove-their-personal-information-from-data-broker-websites /blog/2012/people-hate-data-broker-websites  [R=301,L,NC]
RewriteRule /blog/2012/privacy-themes-in-dark-knight-dark-knight-rises /blog/2012/dark-knight-privacy-themes  [R=301,L,NC]
RewriteRule /blog/2012/recap-of-our-privacy-flash-mob-in-san-francisco-and-nyc /blog/2012/recap-of-our-privacy-flash-mob  [R=301,L,NC]
RewriteRule /blog/2012/sticking-it-to-the-people-search-companies /blog/2012/sticking-it-to-people-search-sites  [R=301,L,NC]
RewriteRule /blog/2012/the-anti-privacy-facebook-glitch-thats-driving-me-insane /blog/2012/facebook-privacy-glitch  [R=301,L,NC]
RewriteRule /blog/2012/the-biggest-changes-to-facebooks-privacy-policies /blog/2012/facebook-privacy-policy-changes  [R=301,L,NC]
RewriteRule /blog/2012/the-free-internet-will-be-just-fine-with-do-not-track-heres-why /blog/2012/free-internet-and-do-not-track  [R=301,L,NC]
RewriteRule /blog/2012/the-simplest-explanation-ever-of-cispa-and-how-it-may-affect-your-online-life /blog/2012/what-is-cispa  [R=301,L,NC]
RewriteRule /blog/2012/these-4-varsity-googling-skills-will-show-you-what-the-web-is-saying-about-you /blog/2012/how-to-google-yourself  [R=301,L,NC]
RewriteRule /blog/2012/twitter-hack-leads-to-massive-password-reset /blog/2012/twitter-password-hack  [R=301,L,NC]
RewriteRule /blog/2012/understanding-your-online-privacy-a-really-long-infographic /blog/2012/understanding-online-privacy  [R=301,L,NC]
RewriteRule /blog/2012/update-answers-from-an-obama-campaign-employee-to-our-privacy-questions /blog/2012/obama-campaign-privacy-questions  [R=301,L,NC]
RewriteRule /blog/2012/were-a-red-herring-top-100-north-america-tech-startup /blog/2012/red-herring-top-tech-startup  [R=301,L,NC]
RewriteRule /blog/2012/what-apple-and-facebooks-new-love-affair-means-for-your-privacy /blog/2012/apple-and-facebook-relationship-and-privacy  [R=301,L,NC]
RewriteRule /blog/2012/what-is-do-not-track-an-illustrated-guide-from-duckduckgo /blog/2012/what-is-do-not-track  [R=301,L,NC]
RewriteRule /blog/2012/whats-your-vote-worth-to-the-2012-presidential-campaigns-our-calculator-tells-you /blog/2012/whats-your-vote-worth-to-presidential-campaigns  [R=301,L,NC]
RewriteRule /blog/2012/when-delete-means-delete-the-inside-story-of-our-ftc-complaint-against-beenverified-com /blog/2012/beenverified-ftc-complaint  [R=301,L,NC]
RewriteRule /blog/2012/why-deleteme-is-a-subscription-service-and-not-a-1-time-thing /blog/2012/why-deleteme-is-a-subscription-service  [R=301,L,NC]
RewriteRule /blog/2012/why-do-not-track-really-means-do-not-target-and-doesnt-protect-your-privacy-on-facebook /blog/2012/do-not-track-means-do-not-target  [R=301,L,NC]
RewriteRule /blog/2012/why-facebook-is-confused-reposting-public-messages-is-still-about-privacy /blog/2012/facebook-privacy-confusion  [R=301,L,NC]
RewriteRule /blog/2012/why-the-do-not-track-header-is-like-a-smoke-signal /blog/2012/do-not-track-smoke-signal  [R=301,L,NC]
RewriteRule /blog/2012/you-decide-facebooks-privacy-policy-heres-how-to-vote /blog/2012/vote-on-facebook-privacy-policy  [R=301,L,NC]
RewriteRule /blog/2012/your-friends-are-sharing-your-info-through-facebook-apps-and-they-dont-even-know-it /blog/2012/your-facebook-friends-are-sharing-your-info  [R=301,L,NC]
RewriteRule /blog/2012/your-netflix-watching-habits-to-be-automatically-broadcast-to-facebook /blog/2012/netflix-facebook-broadcasting  [R=301,L,NC]
RewriteRule /blog/2012/your-old-tweets-resurface-with-twitters-data-reseller-partners /blog/2012/twitter-data-resellers  [R=301,L,NC]
RewriteRule /blog/2012/your-privacy-on-okcupid-the-unromantic-truth /blog/2012/privacy-on-okcupid  [R=301,L,NC]
RewriteRule /blog/2012/youre-getting-facebook-timeline-whether-you-like-it-or-not /blog/2012/facebook-timeline  [R=301,L,NC]
RewriteRule /blog/2011/5-new-facebook-photo-changes-you-need-to-make-to-protect-your-privacy /blog/2011/facebook-photo-privacy-changes  [R=301,L,NC]
RewriteRule /blog/2011/5-things-you-need-to-know-if-you-have-an-online-dating-profile /blog/2011/online-dating-profile  [R=301,L,NC]
RewriteRule /blog/2011/50-cents-for-your-myspace-profile-heres-what-will-happen-to-your-data-now /blog/2011/your-myspace-profile-data  [R=301,L,NC]
RewriteRule /blog/2011/a-visual-guide-to-turning-on-pro-privacy-features-in-your-web-browser /blog/2011/turn-on-privacy-features-in-your-browser  [R=301,L,NC]
RewriteRule /blog/2011/abine-to-be-microsoft-privacy-partner-on-ie9-ships-do-not-track-tracking-protection-list /blog/2011/abine-now-microsoft-privacy-partner  [R=301,L,NC]
RewriteRule /blog/2011/alias-emails-an-easy-way-to-protect-yourself-from-the-next-big-data-breach /blog/2011/get-email-alias-to-avoid-the-next-data-breach  [R=301,L,NC]
RewriteRule /blog/2011/buttons-everywhere-connect-like-recommend-should-you-click /blog/2011/linkedin-share-button-and-other-social-buttons  [R=301,L,NC]
RewriteRule /blog/2011/facebook-auto-sharing-gone-wrong-and-how-to-fix-it /blog/2011/facebook-auto-sharing-gone-wrong  [R=301,L,NC]
RewriteRule /blog/2011/facebook-ftc-settlement-you-still-cant-get-the-most-critical-privacy-setting-you-need /blog/2011/facebook-privacy-settings-and-ftc  [R=301,L,NC]
RewriteRule /blog/2011/getting-from-privacyville-to-the-real-world-of-online-privacy /blog/2011/real-world-of-online-privacy  [R=301,L,NC]
RewriteRule /blog/2011/heads-up-geeks-and-gamers-bioware-is-the-latest-data-breach-victim /blog/2011/bioware-data-breach  [R=301,L,NC]
RewriteRule /blog/2011/how-encryption-can-keep-facebook-from-snooping-in-your-chats /blog/2011/facebook-chat-encryption  [R=301,L,NC]
RewriteRule /blog/2011/how-to-turn-on-do-not-track-in-your-browser /blog/2011/turn-on-do-not-track  [R=301,L,NC]
RewriteRule /blog/2011/infographic-how-people-search-websites-aka-data-brokers-get-your-information /blog/2011/how-data-brokers-get-your-info  [R=301,L,NC]
RewriteRule /blog/2011/is-privacy-dead-or-a-billion-dollar-business /blog/2011/is-privacy-dead  [R=301,L,NC]
RewriteRule /blog/2011/is-your-personal-information-safe-on-okcupid-our-findings-may-surprise-you /blog/2011/is-your-personal-info-safe-on-okcupid  [R=301,L,NC]
RewriteRule /blog/2011/just-a-shot-of-us-using-a-shower-as-a-conference-room /blog/2011/conference-room-shower  [R=301,L,NC]
RewriteRule /blog/2011/linkedin-selling-your-resume-going-public-is-changing-how-linkedin-uses-your-personal-info /blog/2011/linkedin-privacy-and-how-they-use-personal-info  [R=301,L,NC]
RewriteRule /blog/2011/massive-new-data-breach-was-your-email-part-of-the-epsilon-data-breach-should-you-care /blog/2011/epsilon-email-data-loss  [R=301,L,NC]
RewriteRule /blog/2011/mylife-com-sued-for-deception-were-you-duped /blog/2011/who-is-searching-for-you  [R=301,L,NC]
RewriteRule /blog/2011/on-the-internet-youre-guilty-forever-even-when-proven-innocent /blog/2011/online-guilty-before-proven-innocent  [R=301,L,NC]
RewriteRule /blog/2011/online-fortune-teller-how-dna-telemores-can-put-your-lifespan-on-the-web /blog/2011/your-life-on-the-web  [R=301,L,NC]
RewriteRule /blog/2011/privacy-is-not-about-hiding-bad-things /blog/2011/what-is-privacy-about  [R=301,L,NC]
RewriteRule /blog/2011/privacy-with-google-search-reviewing-googles-1-feature /blog/2011/privacy-with-google-search  [R=301,L,NC]
RewriteRule /blog/2011/private-browsing-mode-doesnt-do-anything /blog/2011/private-browsing-mode-does-not-help  [R=301,L,NC]
RewriteRule /blog/2011/regular-people-are-fighting-back-against-big-tracking-companies /blog/2011/big-tracking-companies  [R=301,L,NC]
RewriteRule /blog/2011/smile-youre-on-spokeo-com-concerned-heres-what-to-do /blog/2011/how-to-remove-yourself-from-spokeo  [R=301,L,NC]
RewriteRule /blog/2011/spreading-the-word-on-removing-yourself-from-background-check-sites-part-1 /blog/2011/remove-youself-from-background-check-sites  [R=301,L,NC]
RewriteRule /blog/2011/the-top-6-facial-recognition-faqs /blog/2011/facial-recognition-faqs  [R=301,L,NC]
RewriteRule /blog/2011/this-pretty-much-sums-up-how-we-feel-about-people-search-sites /blog/2011/how-we-feel-about-people-search-sites  [R=301,L,NC]
RewriteRule /blog/2011/to-be-anonymous-or-not-to-be-should-you-use-your-real-name-on-the-internet /blog/2011/internet-anonymity-or-not  [R=301,L,NC]
RewriteRule /blog/2011/to-track-or-not-to-track-introducing-dnt /blog/2011/introducing-donottrackplus-2011  [R=301,L,NC]
RewriteRule /blog/2011/truerep-aka-intelius-creates-your-privacy-problem-now-you-pay-them-to-fix-it /blog/2011/intelius-privacy-irony  [R=301,L,NC]
RewriteRule /blog/2011/usa-today-uncovers-facebook-tracking-we-stop-it /blog/2011/facebook-tracking  [R=301,L,NC]
RewriteRule /blog/2011/what-tech-execs-are-saying-about-your-privacy /blog/2011/tech-execs-on-privacy  [R=301,L,NC]
RewriteRule /blog/2011/what-you-dont-know-about-facebooks-new-buttons /blog/2011/facebooks-new-buttons  [R=301,L,NC]
RewriteRule /blog/2011/why-more-tracking-protection-is-not-better /blog/2011/more-tracking-protection-not-better  [R=301,L,NC]
RewriteRule /blog/2011/would-you-be-happier-with-less-information-online-resolve-to-clean-up-your-online-identity-in-the-new-year-with-deleteme /blog/2011/clean-up-your-online-identity  [R=301,L,NC]
RewriteRule /blog/2011/your-digital-afterlife-6-steps-you-need-to-take-today-to-manage-your-cyber-assets-when-youre-gone /blog/2011/digital-footprint-importance  [R=301,L,NC]
RewriteRule /blog/2011/your-name-their-database-an-update-on-removing-yourself-from-people-search-sites /blog/2011/people-search-sites-update  [R=301,L,NC]
RewriteRule /blog/2010/10-ways-facebook-can-ruin-half-a-billion-lives /blog/2010/facebook-can-ruin-your-life  [R=301,L,NC]
RewriteRule /blog/2010/attention-online-shoppers-dont-let-black-friday-be-track-friday /blog/2010/black-friday-track-friday  [R=301,L,NC]
RewriteRule /blog/2010/come-discuss-privacy-at-mit /blog/2010/discuss-privacy-at-mit  [R=301,L,NC]
RewriteRule /blog/2010/facebooks-iron-fist /blog/2010/facebook-wants-the-real-you  [R=301,L,NC]
RewriteRule /blog/2010/is-facebook-the-great-job-killer-of-the-21st-century /blog/2010/facebook-the-great-job-killer  [R=301,L,NC]
RewriteRule /blog/2010/is-santa-spying-on-you-how-to-shop-online-with-privacy /blog/2010/shop-online-privately  [R=301,L,NC]
RewriteRule /blog/2010/microsoft-and-do-not-track-an-easy-simple-explanation-of-ie9s-new-privacy-push /blog/2010/do-not-track-and-internet-explorer  [R=301,L,NC]
RewriteRule /blog/2010/private-messages-on-social-networking-sites-not-so-private /blog/2010/social-network-private-messages  [R=301,L,NC]
RewriteRule /blog/2010/social-media-privacy-and-aristotle /blog/2010/social-media-and-privacy  [R=301,L,NC]
RewriteRule /blog/2010/the-%E2%80%9Cright-to-be-forgotten%E2%80%9D-in-the-eu /blog/2010/the-right-to-be-forgotten-in-the-eu  [R=301,L,NC]
RewriteRule /blog/2010/the-apple-ipad-att-data-breach-what-it-means-for-privacy-online /blog/2010/ipad-data-breach  [R=301,L,NC]
RewriteRule /blog/2010/the-tide-turned-july-31-2010 /blog/2010/spying-on-consumers  [R=301,L,NC]
RewriteRule /blog/2010/web-coupons-know-lots-about-you-and-they-tell /blog/2010/web-coupons-know-a-lot  [R=301,L,NC]
RewriteRule /blog/2010/your-location-privacy-is-up-for-grabs /blog/2010/location-privacy-up-for-grabs  [R=301,L,NC]

# temp rule to stop crazy zonealarm client
RewriteCond %{REMOTE_ADDR ^88\.134\.143\.50 [OR]
RewriteCond %{REMOTE_ADDR ^107\.23\.240\.63 [OR]
RewriteCond %{REMOTE_ADDR ^87\.161\.141\.175
RewriteRule ^(.*)$ - [F,L]


### Added to patch Comcast bad deleteme link
RewriteCond %{REQUEST_URI} ^/deleteme/faq.php$ [NC]
RewriteRule ^(.*) https://abine.com/products/deleteme/mobile/support/index.php [R=301,L]
###


## Added to change MaskMe link from google results 2013-11-01
RewriteCond %{REQUEST_URI} ^/signup/maskme [NC]
RewriteRule ^(.*) https://www.abine.com/maskme [L]

# Added for DeleteMe
RewriteCond %{REQUEST_URI} ^/deletemedetail.php [NC]
RewriteRule ^(.*) https://www.abine.com/deleteme/landing.php [R=301,L]
RewriteCond %{REQUEST_URI} ^/deleteme/?$ [NC]
RewriteCond %{QUERY_STRING} !q=discounts [NC]
RewriteRule ^(.*) https://www.abine.com/deleteme/landing.php [R=301,L]


SSLProxyEngine on
RewriteCond %{REQUEST_URI} ^/deleteme [NC]
RewriteCond %{REQUEST_URI} !^/deleteme/landing.php [NC]
RewriteCond %{REQUEST_URI} !^/deleteme/iframe.html [NC]
RewriteCond %{REQUEST_URI} !^/deleteme/faq [NC]
#Added to maintain old deleteme faq
RewriteCond %{REQUEST_URI} !^/deletemefaq [NC]
RewriteRule ^(.*) https://glass.abine.com$1 [P,QSA,L]
ProxyPassReverse / https://glass.abine.com/
  
<% end -%>

  # Next hop is HAProxy
  RewriteRule ^/(.*)$ http://127.0.0.1:85%{REQUEST_URI} [P,QSA,L]

  # Special rule to forward "/" directly to haproxy
  RewriteCond %{DOCUMENT_ROOT}/$ -d
  RewriteRule ^/(.*)$ http://127.0.0.1:85%{REQUEST_URI} [P,QSA,L]

  RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} -d
  RewriteRule ^/(.*)$ /$1 [QSA,L]

  # SSL-specific additions
  SSLEngine on
  SSLProtocol all -SSLv2
  SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW

  RequestHeader set X_FORWARDED_PROTO 'https'

  SSLCertificateFile <%= @params[:ssl_certificate_file] %>
  SSLCertificateKeyFile <%= @params[:ssl_key_file] %>
  <% if @params[:ssl_certificate_chain_file] %>
    <%= "SSLCertificateChainFile #{@params[:ssl_certificate_chain_file]}" %>
  <% end %>

  # Deflate
  AddOutputFilterByType DEFLATE text/html text/plain text/xml application/xml application/xhtml+xml text/javascript text/css application/x-javascript
  BrowserMatch ^Mozilla/4 gzip-only-text/html
  BrowserMatch ^Mozilla/4\.0[678] no-gzip
  BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

  SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown downgrade-1.0

  # Proxy the rest to the load balancer
  RewriteRule ^/(.*)$ http://127.0.0.1:85%{REQUEST_URI} [P,QSA,L]

</VirtualHost>
